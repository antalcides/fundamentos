(function(){angular.module("RecursionHelper",[]).factory("RecursionHelper",["$compile",function($compile){return{compile:function(element,link){var compiledContents,contents;return angular.isFunction(link)&&(link={post:link}),contents=element.contents().remove(),compiledContents=void 0,{pre:link&&link.pre?link.pre:null,post:function(scope,element){compiledContents||(compiledContents=$compile(contents)),compiledContents(scope,function(clone){element.append(clone)}),link&&link.post&&link.post.apply(null,arguments)}}}}}])}).call(this),define("modules/recursionHelper",function(){}),function(){angular.module("underscore",[]).factory("_",function(){return window._})}.call(this),define("utils/underscore",function(){}),function(){define("base",["libs","modules/recursionHelper","utils/underscore"],function(){var App;return App=angular.module("SharelatexApp",["ui.bootstrap","autocomplete","RecursionHelper","ng-context-menu","underscore","ngSanitize"])})}.call(this),function(){var __slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};define("main/project-list",["base"],function(App){return App.factory("queuedHttp",function($http,$q){var inflight,pendingRequests,processPendingRequests,queuedHttp;return pendingRequests=[],inflight=!1,processPendingRequests=function(){var doRequest;if(!inflight)return doRequest=pendingRequests.shift(),null!=doRequest?(inflight=!0,doRequest().success(function(){return inflight=!1,processPendingRequests()}).error(function(){return inflight=!1,processPendingRequests()})):void 0},queuedHttp=function(){var args,deferred,doRequest,promise;return args=1<=arguments.length?__slice.call(arguments,0):[],deferred=$q.defer(),promise=deferred.promise,promise.success=function(callback){return promise.then(callback),promise},promise.error=function(callback){return promise["catch"](callback),promise},doRequest=function(){return $http.apply(null,args).success(function(){var successArgs;return successArgs=1<=arguments.length?__slice.call(arguments,0):[],deferred.resolve.apply(deferred,successArgs)}).error(function(){var errorArgs;return errorArgs=1<=arguments.length?__slice.call(arguments,0):[],deferred.reject.apply(deferred,errorArgs)})},pendingRequests.push(doRequest),processPendingRequests(),promise},queuedHttp.post=function(url,data){return queuedHttp({method:"POST",url:url,data:data})},queuedHttp}),App.controller("ProjectPageController",function($scope,$modal,$q,$window,queuedHttp,event_tracking,$timeout){var project,project_id,projectsById,recalculateProjectListHeight,tag,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2;for($scope.projects=window.data.projects,$scope.tags=window.data.tags,$scope.allSelected=!1,$scope.selectedProjects=[],$scope.filter="all",$scope.predicate="lastUpdated",$scope.reverse=!0,recalculateProjectListHeight=function(){var bottomOffset,height,sideBarHeight,topOffset;return topOffset=$(".project-list-card").offset().top,bottomOffset=$("footer").outerHeight()+25,sideBarHeight=$("aside").height()-56,height=$window.innerHeight-topOffset-bottomOffset,sideBarHeight>height&&(height=Math.min(sideBarHeight,$window.innerHeight-topOffset-25)),$scope.projectListHeight=height},$timeout(function(){return recalculateProjectListHeight()},0),angular.element($window).bind("resize",function(){return recalculateProjectListHeight(),$scope.$apply()}),projectsById={},_ref=$scope.projects,_i=0,_len=_ref.length;_len>_i;_i++)project=_ref[_i],projectsById[project.id]=project;for(_ref1=$scope.tags,_j=0,_len1=_ref1.length;_len1>_j;_j++)for(tag=_ref1[_j],_ref2=tag.project_ids||[],_k=0,_len2=_ref2.length;_len2>_k;_k++)project_id=_ref2[_k],project=projectsById[project_id],null!=project&&(project.tags||(project.tags=[]),project.tags.push(tag));return $scope.changePredicate=function(newPredicate){return $scope.predicate===newPredicate&&($scope.reverse=!$scope.reverse),$scope.predicate=newPredicate},$scope.getSortIconClass=function(column){return column===$scope.predicate&&$scope.reverse?"fa-caret-down":column!==$scope.predicate||$scope.reverse?"":"fa-caret-up"},$scope.searchProjects=function(){return event_tracking.send("project-list-page-interaction","project-search","keydown"),$scope.updateVisibleProjects()},$scope.clearSearchText=function(){return $scope.searchText="",$scope.filter="all",$scope.$emit("search:clear"),$scope.updateVisibleProjects()},$scope.setFilter=function(filter){return $scope.filter=filter,$scope.updateVisibleProjects()},$scope.updateSelectedProjects=function(){return $scope.selectedProjects=$scope.projects.filter(function(project){return project.selected})},$scope.getSelectedProjects=function(){return $scope.selectedProjects},$scope.getSelectedProjectIds=function(){return $scope.selectedProjects.map(function(project){return project.id})},$scope.getFirstSelectedProject=function(){return $scope.selectedProjects[0]},$scope.updateVisibleProjects=function(){var selectedTag,visible,_l,_len3,_ref3,_ref4;for($scope.visibleProjects=[],selectedTag=$scope.getSelectedTag(),_ref3=$scope.projects,_l=0,_len3=_ref3.length;_len3>_l;_l++)project=_ref3[_l],visible=!0,null!=$scope.searchText&&""!==$scope.searchText&&(project.name.toLowerCase().match($scope.searchText.toLowerCase())||(visible=!1)),"tag"===$scope.filter&&null!=selectedTag&&(_ref4=project.id,__indexOf.call(selectedTag.project_ids,_ref4)<0)&&(visible=!1),"shared"===$scope.filter&&"owner"===project.accessLevel&&(visible=!1),"owned"===$scope.filter&&"owner"!==project.accessLevel&&(visible=!1),"archived"===$scope.filter?project.archived||(visible=!1):project.archived&&(visible=!1),visible?$scope.visibleProjects.push(project):project.selected=!1;return $scope.updateSelectedProjects()},$scope.getSelectedTag=function(){var _l,_len3,_ref3;for(_ref3=$scope.tags,_l=0,_len3=_ref3.length;_len3>_l;_l++)if(tag=_ref3[_l],tag.selected)return tag;return null},$scope._removeProjectIdsFromTagArray=function(tag,remove_project_ids){var remaining_project_ids,removed_project_ids,_l,_len3,_ref3;for(remaining_project_ids=[],removed_project_ids=[],_ref3=tag.project_ids,_l=0,_len3=_ref3.length;_len3>_l;_l++)project_id=_ref3[_l],__indexOf.call(remove_project_ids,project_id)<0?remaining_project_ids.push(project_id):removed_project_ids.push(project_id);return tag.project_ids=remaining_project_ids,removed_project_ids},$scope._removeProjectFromList=function(project){var index;return index=$scope.projects.indexOf(project),index>-1?$scope.projects.splice(index,1):void 0},$scope.removeSelectedProjectsFromTag=function(tag){var index,remaining_tags,removed_project_ids,selected_project_ids,selected_projects,_l,_len3,_len4,_m;for(tag.showWhenEmpty=!0,selected_project_ids=$scope.getSelectedProjectIds(),selected_projects=$scope.getSelectedProjects(),removed_project_ids=$scope._removeProjectIdsFromTagArray(tag,selected_project_ids),remaining_tags=[],_l=0,_len3=selected_projects.length;_len3>_l;_l++)project=selected_projects[_l],project.tags||(project.tags=[]),index=project.tags.indexOf(tag),index>-1&&project.tags.splice(index,1);for(_m=0,_len4=removed_project_ids.length;_len4>_m;_m++)project_id=removed_project_ids[_m],queuedHttp.post("/project/"+project_id+"/tag",{deletedTag:tag.name,_csrf:window.csrfToken});return $scope.updateVisibleProjects()},$scope.addSelectedProjectsToTag=function(tag){var added_project_ids,selected_projects,_l,_len3,_len4,_len5,_m,_n,_ref3,_results;for(selected_projects=$scope.getSelectedProjects(),event_tracking.send("project-list-page-interaction","project action","addSelectedProjectsToTag"),added_project_ids=[],_ref3=$scope.getSelectedProjectIds(),_l=0,_len3=_ref3.length;_len3>_l;_l++)project_id=_ref3[_l],__indexOf.call(tag.project_ids,project_id)<0&&(tag.project_ids.push(project_id),added_project_ids.push(project_id));for(_m=0,_len4=selected_projects.length;_len4>_m;_m++)project=selected_projects[_m],project.tags||(project.tags=[]),__indexOf.call(project.tags,tag)<0&&project.tags.push(tag);for(_results=[],_n=0,_len5=added_project_ids.length;_len5>_n;_n++)project_id=added_project_ids[_n],_results.push(queuedHttp.post("/project/"+project_id+"/tag",{tag:tag.name,_csrf:window.csrfToken}));return _results},$scope.createTag=function(name){return event_tracking.send("project-list-page-interaction","project action","createTag"),$scope.tags.push({name:name,project_ids:[],showWhenEmpty:!0})},$scope.openNewTagModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"newTagModalTemplate",controller:"NewTagModalController"}),modalInstance.result.then(function(newTagName){return $scope.createTag(newTagName)})},$scope.createProject=function(name,template){var deferred;return null==template&&(template="none"),deferred=$q.defer(),queuedHttp.post("/project/new",{_csrf:window.csrfToken,projectName:name,template:template}).success(function(data){return $scope.projects.push({name:name,_id:data.project_id,accessLevel:"owner"}),$scope.updateVisibleProjects(),deferred.resolve(data.project_id)}).error(function(){return deferred.reject()}),deferred.promise},$scope.openCreateProjectModal=function(template){var modalInstance;return null==template&&(template="none"),event_tracking.send("project-list-page-interaction","new-project",template),modalInstance=$modal.open({templateUrl:"newProjectModalTemplate",controller:"NewProjectModalController",resolve:{template:function(){return template}},scope:$scope}),modalInstance.result.then(function(project_id){return window.location="/project/"+project_id})},$scope.renameProject=function(project,newName){return project.name=newName,queuedHttp.post("/project/"+project.id+"/rename",{newProjectName:newName,_csrf:window.csrfToken})},$scope.openRenameProjectModal=function(){var modalInstance;return project=$scope.getFirstSelectedProject(),null!=project&&"owner"===project.accessLevel?(event_tracking.send("project-list-page-interaction","project action","Rename"),modalInstance=$modal.open({templateUrl:"renameProjectModalTemplate",controller:"RenameProjectModalController",resolve:{projectName:function(){return project.name}}}),modalInstance.result.then(function(newName){return $scope.renameProject(project,newName)})):void 0},$scope.cloneProject=function(project,cloneName){var deferred;return deferred=$q.defer(),event_tracking.send("project-list-page-interaction","project action","Clone"),queuedHttp.post("/project/"+project.id+"/clone",{_csrf:window.csrfToken,projectName:cloneName}).success(function(data){return $scope.projects.push({name:cloneName,id:data.project_id,accessLevel:"owner"}),$scope.updateVisibleProjects(),deferred.resolve(data.project_id)}).error(function(){return deferred.reject()}),deferred.promise},$scope.openCloneProjectModal=function(){var modalInstance;return project=$scope.getFirstSelectedProject(),null!=project?modalInstance=$modal.open({templateUrl:"cloneProjectModalTemplate",controller:"CloneProjectModalController",resolve:{project:function(){return project}},scope:$scope}):void 0},$scope.openArchiveProjectsModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteProjectsModalTemplate",controller:"DeleteProjectsModalController",resolve:{projects:function(){return $scope.getSelectedProjects()}}}),event_tracking.send("project-list-page-interaction","project action","Delete"),modalInstance.result.then(function(){return $scope.archiveOrLeaveSelectedProjects()})},$scope.archiveOrLeaveSelectedProjects=function(){var selected_project_ids,selected_projects,_l,_len3,_len4,_m,_ref3;for(selected_projects=$scope.getSelectedProjects(),selected_project_ids=$scope.getSelectedProjectIds(),_ref3=$scope.tags,_l=0,_len3=_ref3.length;_len3>_l;_l++)tag=_ref3[_l],$scope._removeProjectIdsFromTagArray(tag,selected_project_ids);for(_m=0,_len4=selected_projects.length;_len4>_m;_m++)project=selected_projects[_m],"owner"===project.accessLevel?(project.archived=!0,queuedHttp({method:"DELETE",url:"/project/"+project.id,headers:{"X-CSRF-Token":window.csrfToken}})):($scope._removeProjectFromList(project),queuedHttp({method:"POST",url:"/project/"+project.id+"/leave",headers:{"X-CSRF-Token":window.csrfToken}}));return $scope.updateVisibleProjects()},$scope.openDeleteProjectsModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteProjectsModalTemplate",controller:"DeleteProjectsModalController",resolve:{projects:function(){return $scope.getSelectedProjects()}}}),modalInstance.result.then(function(){return $scope.deleteSelectedProjects()})},$scope.deleteSelectedProjects=function(){var selected_project_ids,selected_projects,_l,_len3,_len4,_len5,_m,_n,_ref3;for(selected_projects=$scope.getSelectedProjects(),selected_project_ids=$scope.getSelectedProjectIds(),_l=0,_len3=selected_projects.length;_len3>_l;_l++)project=selected_projects[_l],$scope._removeProjectFromList(project);for(_ref3=$scope.tags,_m=0,_len4=_ref3.length;_len4>_m;_m++)tag=_ref3[_m],$scope._removeProjectIdsFromTagArray(tag,selected_project_ids);for(_n=0,_len5=selected_project_ids.length;_len5>_n;_n++)project_id=selected_project_ids[_n],queuedHttp({method:"DELETE",url:"/project/"+project_id+"?forever=true",headers:{"X-CSRF-Token":window.csrfToken}});return $scope.updateVisibleProjects()},$scope.restoreSelectedProjects=function(){var selected_project_ids,selected_projects,_l,_len3,_len4,_m;for(selected_projects=$scope.getSelectedProjects(),selected_project_ids=$scope.getSelectedProjectIds(),_l=0,_len3=selected_projects.length;_len3>_l;_l++)project=selected_projects[_l],project.archived=!1;for(_m=0,_len4=selected_project_ids.length;_len4>_m;_m++)project_id=selected_project_ids[_m],queuedHttp({method:"POST",url:"/project/"+project_id+"/restore",headers:{"X-CSRF-Token":window.csrfToken}});return $scope.updateVisibleProjects()},$scope.openUploadProjectModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"uploadProjectModalTemplate",controller:"UploadProjectModalController"})},$scope.downloadSelectedProjects=function(){var path,selected_project_ids;return selected_project_ids=$scope.getSelectedProjectIds(),event_tracking.send("project-list-page-interaction","project action","Download Zip"),path=selected_project_ids.length>1?"/project/download/zip?project_ids="+selected_project_ids.join(","):"/project/"+selected_project_ids[0]+"/download/zip",window.location=path},$scope.updateVisibleProjects()}),App.controller("ProjectListItemController",function($scope){return $scope.ownerName=function(){return"owner"===$scope.project.accessLevel?"You":null!=$scope.project.owner?""+$scope.project.owner.first_name+" "+$scope.project.owner.last_name:"?"},$scope.$watch("project.selected",function(value){return null!=value?$scope.updateSelectedProjects():void 0})}),App.controller("TagListController",function($scope){return $scope.filterProjects=function(filter){return null==filter&&(filter="all"),$scope._clearTags(),$scope.setFilter(filter)},$scope._clearTags=function(){var tag,_i,_len,_ref,_results;for(_ref=$scope.tags,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)tag=_ref[_i],_results.push(tag.selected=!1);return _results},$scope.nonEmpty=function(tag){return tag.project_ids.length>0||!!tag.showWhenEmpty},$scope.selectTag=function(tag){return $scope._clearTags(),tag.selected=!0,$scope.setFilter("tag")}}),App.controller("TagDropdownItemController",function($scope){return $scope.recalculateProjectsInTag=function(){var partialSelection,project_id,_i,_len,_ref;for($scope.areSelectedProjectsInTag=!1,_ref=$scope.getSelectedProjectIds(),_i=0,_len=_ref.length;_len>_i;_i++)project_id=_ref[_i],__indexOf.call($scope.tag.project_ids,project_id)>=0?$scope.areSelectedProjectsInTag=!0:partialSelection=!0;return $scope.areSelectedProjectsInTag&&partialSelection?$scope.areSelectedProjectsInTag="partial":void 0},$scope.addOrRemoveProjectsFromTag=function(){return $scope.areSelectedProjectsInTag===!0?($scope.removeSelectedProjectsFromTag($scope.tag),$scope.areSelectedProjectsInTag=!1):$scope.areSelectedProjectsInTag===!1||"partial"===$scope.areSelectedProjectsInTag?($scope.addSelectedProjectsToTag($scope.tag),$scope.areSelectedProjectsInTag=!0):void 0},$scope.$watch("selectedProjects",function(){return $scope.recalculateProjectsInTag()}),$scope.recalculateProjectsInTag()}),App.controller("NewTagModalController",function($scope,$modalInstance,$timeout){return $scope.inputs={newTagName:""},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.create=function(){return $modalInstance.close($scope.inputs.newTagName)},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("RenameProjectModalController",function($scope,$modalInstance,$timeout,projectName){return $scope.inputs={projectName:projectName},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.rename=function(){return $modalInstance.close($scope.inputs.projectName)},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("CloneProjectModalController",function($scope,$modalInstance,$timeout,project){return $scope.inputs={projectName:project.name+" (Copy)"},$scope.state={inflight:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.clone=function(){return $scope.state.inflight=!0,$scope.cloneProject(project,$scope.inputs.projectName).then(function(project_id){return $scope.state.inflight=!1,$modalInstance.close(project_id)})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("NewProjectModalController",function($scope,$modalInstance,$timeout,template){return $scope.inputs={projectName:""},$scope.state={inflight:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.create=function(){return $scope.state.inflight=!0,$scope.createProject($scope.inputs.projectName,template).then(function(project_id){return $scope.state.inflight=!1,$modalInstance.close(project_id)})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("DeleteProjectsModalController",function($scope,$modalInstance,$timeout,projects){return $scope.projectsToDelete=projects.filter(function(project){return"owner"===project.accessLevel}),$scope.projectsToLeave=projects.filter(function(project){return"owner"!==project.accessLevel}),$scope.action=$scope.projectsToLeave.length>0&&$scope.projectsToDelete.length>0?"Delete & Leave":0===$scope.projectsToLeave.length&&$scope.projectsToDelete.length>0?"Delete":"Leave",$scope["delete"]=function(){return $modalInstance.close()},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}),App.controller("UploadProjectModalController",function($scope,$modalInstance){return $scope.cancel=function(){return $modalInstance.dismiss("cancel")},$scope.onComplete=function(error,name,response){return null!=response.project_id?window.location="/project/"+response.project_id:void 0}})})}.call(this),function(){define("main/user-details",["base","libs/algolia-2.5.2"],function(App){return App.factory("Institutions",function(){return new AlgoliaSearch(window.algolia.institutions.app_id,window.algolia.institutions.api_key).initIndex("institutions")}),App.controller("UserProfileController",function($scope,$modal,$http){return $scope.institutions=[],$http.get("/user/personal_info").success(function(data){return $scope.userInfoForm={first_name:data.first_name||"",last_name:data.last_name||"",role:data.role||"",institution:data.institution||"",_csrf:window.csrfToken}}),$scope.showForm=function(){return $scope.formVisable=!0},$scope.getPercentComplete=function(){var results;return results=_.filter($scope.userInfoForm,function(value){return null==value||0!==(null!=value?value.length:void 0)}),20*results.length},$scope.$watch("userInfoForm",function(value){return null!=value?$scope.percentComplete=$scope.getPercentComplete():void 0},!0),$scope.openUserProfileModal=function(){return $modal.open({templateUrl:"userProfileModalTemplate",controller:"UserProfileModalController",scope:$scope})}}),App.controller("UserProfileModalController",function($scope,$modalInstance,$http,Institutions){var sendUpdate;return $scope.roles=["Student","Post-graduate student","Post-doctoral researcher","Lecturer","Professor"],$modalInstance.result["finally"](function(){return sendUpdate()}),sendUpdate=function(){var request;return request=$http.post("/user/settings",$scope.userInfoForm),request.success(function(){}),request.error(function(){return console.log("the request failed")})},$scope.updateInstitutionsList=function(){var query;return query=$scope.userInfoForm.institution,(null!=query?query.length:void 0)<=3?void 0:Institutions.search($scope.userInfoForm.institution,function(err,response){return $scope.institutions=_.map(response.hits,function(institution){return""+institution.name+" ("+institution.domain+")"})})},$scope.done=function(){return $modalInstance.close()}})})}.call(this),function(){define("main/account-settings",["base"],function(App){return App.controller("AccountSettingsController",["$scope","$http","$modal",function($scope,$http,$modal){return $scope.subscribed=!0,$scope.unsubscribe=function(){return $scope.unsubscribing=!0,$http({method:"DELETE",url:"/user/newsletter/unsubscribe",headers:{"X-CSRF-Token":window.csrfToken}}).success(function(){return $scope.unsubscribing=!1,$scope.subscribed=!1}).error(function(){return $scope.unsubscribing=!0})},$scope.deleteAccount=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"deleteAccountModalTemplate",controller:"DeleteAccountModalController"})}}]),App.controller("DeleteAccountModalController",["$scope","$modalInstance","$timeout","$http",function($scope,$modalInstance,$timeout,$http){return $scope.state={isValid:!1,deleteText:"",inflight:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},700)}),$scope.checkValidation=function(){return $scope.state.isValid="DELETE"===$scope.state.deleteText},$scope["delete"]=function(){return $scope.state.inflight=!0,$http({method:"DELETE",url:"/user",headers:{"X-CSRF-Token":window.csrfToken}}).success(function(){return $modalInstance.close(),window.location="/"})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}])})}.call(this),function(){define("main/templates",["base"],function(App){return App.controller("openInSlController",function($scope){return $scope.openInSlText="Open in ShareLaTeX",$scope.isDisabled=!1,$scope.open=function(){return $scope.openInSlText="Creating...",$scope.isDisabled=!0,ga("send","event","template-site","open-in-sl",$(".page-header h1").text())},$scope.downloadZip=function(){return ga("send","event","template-site","download-zip",$(".page-header h1").text())}}),App.factory("algolia",function(){var client,index,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;return null!=("undefined"!=typeof window&&null!==window&&null!=(_ref=window.sharelatex)&&null!=(_ref1=_ref.algolia)?_ref1.app_id:void 0)?(client=new AlgoliaSearch(null!=(_ref2=window.sharelatex.algolia)?_ref2.app_id:void 0,null!=(_ref3=window.sharelatex.algolia)?_ref3.api_key:void 0),index=client.initIndex(null!=(_ref4=window.sharelatex.algolia)&&null!=(_ref5=_ref4.indexes)?_ref5.templates:void 0)):void 0}),App.controller("SearchController",function($scope,algolia,_){var buildHitViewModel,updateHits;return $scope.hits=[],$scope.clearSearchText=function(){return $scope.searchQueryText="",updateHits([])},$scope.safeApply=function(fn){var phase;return phase=$scope.$root.$$phase,"$apply"===phase||"$digest"===phase?$scope.$eval(fn):$scope.$apply(fn)},buildHitViewModel=function(hit){var result,_ref,_ref1;return result={name:hit._highlightResult.name.value,description:hit._highlightResult.description.value,url:"/templates/"+hit._id,image_url:""+(null!=(_ref=window.sharelatex)&&null!=(_ref1=_ref.templates)?_ref1.cdnDomain:void 0)+"/"+hit._id+"/v/"+hit.version+"/pdf-converted-cache/style-thumbnail"}},updateHits=function(hits){return $scope.safeApply(function(){return $scope.hits=hits})},$scope.search=function(){var query,_ref,_ref1;return query=$scope.searchQueryText,null==query||0===query.length?void updateHits([]):(query=""+(null!=(_ref=window.sharelatex)&&null!=(_ref1=_ref.templates)?_ref1.user_id:void 0)+" "+query,algolia.search(query,function(err,response){var hits;return 0===response.hits.length?updateHits([]):(hits=_.map(response.hits,buildHitViewModel),updateHits(hits))}))}})})}.call(this),function(){define("main/plans",["base"],function(App){return App.controller("PlansController",function($scope,$modal,event_tracking){return $scope.ui={view:"monthly"},$scope.signUpNowClicked=function(plan){return"annual"===$scope.ui.view&&(plan=""+plan+"_annual"),event_tracking.send("subscription-funnel","sign_up_now_button",plan)},$scope.switchToMonthly=function(){return $scope.ui.view="monthly",event_tracking.send("subscription-funnel","plans-page","monthly-prices")},$scope.switchToStudent=function(){return $scope.ui.view="student",event_tracking.send("subscription-funnel","plans-page","student-prices")},$scope.switchToAnnual=function(){return $scope.ui.view="annual",event_tracking.send("subscription-funnel","plans-page","student-prices")},$scope.openGroupPlanModal=function(){return $modal.open({templateUrl:"groupPlanModalTemplate"})}})})}.call(this),function(){define("main/group-members",["base"],function(App){return App.controller("GroupMembersController",function($scope,queuedHttp){var parseEmails;return $scope.users=window.users,$scope.groupSize=window.groupSize,$scope.selectedUsers=[],$scope.inputs={emails:""},parseEmails=function(emailsString){var emails,regexBySpaceOrComma;return regexBySpaceOrComma=/[\s,]+/,emails=emailsString.split(regexBySpaceOrComma),emails=_.map(emails,function(email){return email=email.trim()}),emails=_.select(emails,function(email){return-1!==email.indexOf("@")})},$scope.addMembers=function(){var email,emails,_i,_len,_results;for(emails=parseEmails($scope.inputs.emails),_results=[],_i=0,_len=emails.length;_len>_i;_i++)email=emails[_i],_results.push(queuedHttp.post("/subscription/group/user",{email:email,_csrf:window.csrfToken}).success(function(data){return null!=data.user&&$scope.users.push(data.user),$scope.inputs.emails=""}));return _results},$scope.removeMembers=function(){var user,_fn,_i,_len,_ref;for(_ref=$scope.selectedUsers,_fn=function(user){return queuedHttp({method:"DELETE",url:"/subscription/group/user/"+user._id,headers:{"X-Csrf-Token":window.csrfToken}}).success(function(){var index;return index=$scope.users.indexOf(user),-1!==index?$scope.users.splice(index,1):void 0})},_i=0,_len=_ref.length;_len>_i;_i++)user=_ref[_i],_fn(user);return $scope.selectedUsers=[]},$scope.updateSelectedUsers=function(){return $scope.selectedUsers=$scope.users.filter(function(user){return user.selected})}}),App.controller("GroupMemberListItemController",function($scope){return $scope.$watch("user.selected",function(value){return null!=value?$scope.updateSelectedUsers():void 0})})})}.call(this),function(){define("main/scribtex-popup",["base"],function(App){return App.controller("ScribtexPopupController",function($scope,$modal){return $modal.open({templateUrl:"scribtexModalTemplate"})})})}.call(this),function(){define("main/event-tracking",["base"],function(App){return App.factory("event_tracking",function(){return{send:function(category,action,label,value){return ga("send","event",category,action,label,value)}}}),$(".navbar a").on("click",function(e){var href;return href=$(e.target).attr("href"),null!=href?ga("send","event","navigation","top menu bar",href):void 0})})}.call(this),function(){define("main/bonus",["base"],function(App){return App.controller("BonusLinksController",function($scope,$modal){return $scope.openLinkToUsModal=function(){return $modal.open({templateUrl:"BonusLinkToUsModal",controller:"BonusModalController"})}}),App.controller("BonusModalController",function($scope,$modalInstance){return $scope.cancel=function(){return $modalInstance.dismiss()}})})}.call(this),function(){define("main/system-messages",["base"],function(App){return App.controller("SystemMessagesController",function($scope){return $scope.messages=window.systemMessages}),App.controller("SystemMessageController",function($scope,$sce){return $scope.hidden=$.localStorage("systemMessage.hide."+$scope.message._id),$scope.htmlContent=$sce.trustAsHtml($scope.message.content),$scope.hide=function(){return $scope.hidden=!0,$.localStorage("systemMessage.hide."+$scope.message._id,!0)}})})}.call(this),function(){define("directives/asyncForm",["base"],function(App){return App.directive("asyncForm",function($http){return{link:function(scope,element,attrs){var formName,response;return formName=attrs.asyncForm,scope[attrs.name].response=response={},scope[attrs.name].inflight=!1,element.on("submit",function(e){var data,formData,_i,_len,_ref;for(e.preventDefault(),formData={},_ref=element.serializeArray(),_i=0,_len=_ref.length;_len>_i;_i++)data=_ref[_i],formData[data.name]=data.value;return scope[attrs.name].inflight=!0,$http.post(element.attr("action"),formData).success(function(data){return scope[attrs.name].inflight=!1,response.success=!0,response.error=!1,null!=data.redir?(ga("send","event",formName,"success"),window.location=data.redir):null!=data.message?(response.message=data.message,"error"===data.message.type?(response.success=!1,response.error=!0,ga("send","event",formName,"failure",data.message)):ga("send","event",formName,"success")):void 0}).error(function(data){var _ref1;return scope[attrs.name].inflight=!1,response.success=!1,response.error=!0,response.message={text:(null!=(_ref1=data.message)?_ref1.text:void 0)||data.message||"Something went wrong talking to the server :(. Please try again.",type:"error"},ga("send","event",formName,"failure",data.message)})})}}}),App.directive("formMessages",function(){return{restrict:"E",template:"<div class=\"alert\" ng-class=\"{\n	'alert-danger': form.response.message.type == 'error',\n	'alert-success': form.response.message.type != 'error'\n}\" ng-show=\"!!form.response.message\">\n	{{form.response.message.text}}\n</div>\n<div ng-transclude></div>",transclude:!0,scope:{form:"=for"}}})})}.call(this),function(){define("directives/stopPropagation",["base"],function(App){return App.directive("stopPropagation",function(){return{restrict:"A",link:function(scope,element,attrs){return element.bind(attrs.stopPropagation,function(e){return e.stopPropagation()})}}}),App.directive("preventDefault",function(){return{restrict:"A",link:function(scope,element,attrs){return element.bind(attrs.preventDefault,function(e){return e.preventDefault()})}}})})}.call(this),function(){define("directives/focus",["base"],function(App){var selectName;return App.directive("focusWhen",function($timeout){return{restrict:"A",link:function(scope,element,attr){return scope.$watch(attr.focusWhen,function(value){return value?$timeout(function(){return element.focus()}):void 0})}}}),App.directive("focusOn",function(){return{restrict:"A",link:function(scope,element,attrs){return scope.$on(attrs.focusOn,function(){return element.focus()})}}}),App.directive("selectWhen",function($timeout){return{restrict:"A",link:function(scope,element,attr){return scope.$watch(attr.selectWhen,function(value){return value?$timeout(function(){return element.select()}):void 0})}}}),App.directive("selectOn",function(){return{restrict:"A",link:function(scope,element,attrs){return scope.$on(attrs.selectOn,function(){return element.select()})}}}),App.directive("selectNameWhen",function($timeout){return{restrict:"A",link:function(scope,element,attrs){return scope.$watch(attrs.selectNameWhen,function(value){return value?$timeout(function(){return selectName(element)}):void 0})}}}),App.directive("selectNameOn",function(){return{restrict:"A",link:function(scope,element,attrs){return scope.$on(attrs.selectNameOn,function(){return selectName(element)})}}}),App.directive("focus",function($timeout){return{scope:{trigger:"@focus"},link:function(scope,element){return scope.$watch("trigger",function(value){return"true"===value?$timeout(function(){return element[0].focus()
}):void 0})}}}),selectName=function(element){var name,selectionEnd;return element.focus(),name=element.val(),null!=element[0].setSelectionRange?(selectionEnd=name.lastIndexOf("."),-1===selectionEnd&&(selectionEnd=name.length),element[0].setSelectionRange(0,selectionEnd)):void 0}})}.call(this),function(){define("directives/equals",["base"],function(App){return App.directive("equals",[function(){return{require:"ngModel",link:function(scope,elem,attrs,ctrl){var firstField;return firstField="#"+attrs.equals,elem.add(firstField).on("keyup",function(){return scope.$apply(function(){var equal;return equal=elem.val()===$(firstField).val(),ctrl.$setValidity("areEqual",equal)})})}}}])})}.call(this),function(){define("directives/fineUpload",["base"],function(App){return App.directive("fineUpload",function(){return{scope:{multiple:"=",endpoint:"@",waitingForResponseText:"@",failedUploadText:"@",uploadButtonText:"@",dragAreaText:"@",hintText:"@",allowedExtensions:"=",onCompleteCallback:"=",onUploadCallback:"=",params:"="},link:function(scope,element){var dragAreaText,endpoint,hintText,multiple,onComplete,onUpload,params,text,validation;return multiple=scope.multiple||!1,endpoint=scope.endpoint,validation=null!=scope.allowedExtensions?{allowedExtensions:scope.allowedExtensions}:{},text={waitingForResponse:scope.waitingForResponseText||"Processing...",failUpload:scope.failedUploadText||"Failed :(",uploadButton:scope.uploadButtonText||"Upload"},dragAreaText=scope.dragAreaText||"drag here",hintText=scope.hintText||"",onComplete=scope.onCompleteCallback||function(){},onUpload=scope.onUploadCallback||function(){},params=scope.params||{},params._csrf=window.csrfToken,new qq.FineUploader({element:element[0],multiple:multiple,disabledCancelForFormUploads:!0,validation:validation,request:{endpoint:endpoint,forceMultipart:!0,params:params,paramsInBody:!1},callbacks:{onComplete:onComplete,onUpload:onUpload},text:text,template:'<div class="qq-uploader">\n	<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>\n	<div class="qq-upload-button btn btn-primary btn-lg">\n		<div>{uploadButtonText}</div>\n	</div>\n	<span class="or btn-lg"> or </span>\n	<span class="drag-here btn-lg">'+dragAreaText+'</span>\n	<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>\n	<div class="small">'+hintText+'</div>\n	<ul class="qq-upload-list"></ul>\n</div>'})}}})})}.call(this),function(){define("directives/onEnter",["base"],function(App){return App.directive("onEnter",function(){return function(scope,element,attrs){return element.bind("keydown keypress",function(event){return 13===event.which?(scope.$apply(function(){return scope.$eval(attrs.onEnter,{event:event})}),event.preventDefault()):void 0})}})})}.call(this),function(){define("directives/selectAll",["base"],function(App){return App.directive("selectAllList",function(){return{controller:["$scope",function($scope){var clearSelectAllState,deselectAll,selectAll;return selectAll=function(){return $scope.$broadcast("select-all:select")},deselectAll=function(){return $scope.$broadcast("select-all:deselect")},clearSelectAllState=function(){return $scope.$broadcast("select-all:clear")},{clearSelectAllState:clearSelectAllState,selectAll:selectAll,deselectAll:deselectAll}}],link:function(){}}}),App.directive("selectAll",function(){return{require:"^selectAllList",link:function(scope,element,attrs,selectAllListController){return scope.$on("select-all:clear",function(){return element.prop("checked",!1)}),element.change(function(){return element.is(":checked")?selectAllListController.selectAll():selectAllListController.deselectAll(),!0})}}}),App.directive("selectIndividual",function(){return{require:"^selectAllList",scope:{ngModel:"="},link:function(scope,element,attrs,selectAllListController){var ignoreChanges;return ignoreChanges=!1,scope.$watch("ngModel",function(value){return null==value||ignoreChanges?void 0:selectAllListController.clearSelectAllState()}),scope.$on("select-all:select",function(){return ignoreChanges=!0,scope.$apply(function(){return scope.ngModel=!0}),ignoreChanges=!1}),scope.$on("select-all:deselect",function(){return ignoreChanges=!0,scope.$apply(function(){return scope.ngModel=!1}),ignoreChanges=!1})}}})})}.call(this),function(){define("directives/maxHeight",["base"],function(App){return App.directive("maxHeight",function(){return{restrict:"A",link:function(scope,element,attrs){return scope.$watch(attrs.maxHeight,function(value){return null!=value?element.css({"max-height":value}):void 0})}}})})}.call(this),function(){define("filters/formatDate",["base"],function(App){return moment.lang("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"ddd, Do MMM YY",nextWeek:"ddd, Do MMM YY",sameElse:"ddd, Do MMM YY"}}),App.filter("formatDate",function(){return function(date,format){return null==format&&(format="Do MMM YYYY, h:mm a"),moment(date).format(format)}}),App.filter("relativeDate",function(){return function(date){return moment(date).calendar()}})})}.call(this),function(){define("main",["main/project-list","main/user-details","main/account-settings","main/templates","main/plans","main/group-members","main/scribtex-popup","main/event-tracking","main/bonus","main/system-messages","directives/asyncForm","directives/stopPropagation","directives/focus","directives/equals","directives/fineUpload","directives/onEnter","directives/selectAll","directives/maxHeight","filters/formatDate"],function(){return angular.bootstrap(document.body,["SharelatexApp"])})}.call(this);